<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.1.9/lib/p5.js"></script>
  </head>
  <body>
    <main>
    </main>

    <script type="text/javascript">
      const t = window.TrelloPowerUp.iframe();

      const WIDTH = 300;
      const HEIGHT = 200;

      let currentStep = 0;
      let x, y;

      let x1 = 0,
        x2 = WIDTH/2-WIDTH/6,
        x3 = WIDTH/2+WIDTH/6,
        x4 = WIDTH;

      let y1 = HEIGHT,
        y2 = HEIGHT/3,
        y3 = HEIGHT/3,
        y4 = HEIGHT;

      function setup() {
        createCanvas(WIDTH, HEIGHT);
      }

      function draw() {
        background("white");
        stroke("gray");
        noFill();
        line(WIDTH/2, HEIGHT/2, WIDTH/2, HEIGHT);

        stroke("black");
        let steps = WIDTH;
        let t = currentStep/steps;
        bezier(x1, y1, x2, y2, x3, y3, x4, y4);
        x = bezierPoint(x1, x2, x3, x4, t);
        y = bezierPoint(y1, y2, y3, y4, t);
        fill("aquamarine");
        circle(x, y, 15);
      }

      function mouseClicked() {
        currentStep = mouseX;

        t.card('all').then(async function(card) {
          await fetch('https://trello-hill-chart.herokuapp.com/scopes/status', {
            method: 'POST',
            body: JSON.stringify({
              trello_card_id: card.id,
              progress: mouseX
            })
          })
        });
      }
    </script>
  </body>
</html>
